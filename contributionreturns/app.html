<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Responsive -->
    <meta charset="utf-8">
    <meta content="ie=edge">

    <!-- Title -->
    <title>Contribution Calculator</title>
    <!-- Meta Tags required for
       Progressive Web App -->
    <meta name="apple-mobile-web-app-status-bar" content="#aa7700">
    <meta name="theme-color" content="black">

    <!-- Manifest File link -->
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.plot.ly/plotly-2.3.1.min.js"></script>
    <script src="app.js"></script>
    <link rel="stylesheet" href="app.css">
    <script type="text/javascript">
        window.addEventListener('load', () => {
            registerSW();
        });

        // Register the Service Worker
        async function registerSW() {
            if ('serviceWorker' in navigator) {
                try {
                    await navigator
                        .serviceWorker
                        .register('serviceworker.js');
                }
                catch (e) {
                    console.log('SW registration failed');
                }
            }
        }
    </script>
</head>

<body onload="init()">
    
    <div class="flex-container">
        
        <div class="input">
            <table style="width:100%;">
                <tr>
                    <th>Value</th>
                    <th>Optimistic<abbr title="Use retirement savings, and good return rate"></abbr></th>
                    <th>Pessimistic<abbr title="Use net worth, and poor return rate"></th>
                    <th>Units</th>
                </tr>
                <tr></tr>
                <td><label for="p0_opt"><abbr title="How much you have now">Principle</label><br></td>
                <td><input type="text" class="currency" id="p0_opt" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)"></td>
                <td><input type="text" class="currency" id="p0_pes" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)""></td>
                <td>Dollars</td>
                </tr>
                <tr>
                    <td><label for="pmax_opt"><abbr title="How much you think you'll need">Goal</abbr></label></td>
                    <td><input type="text" class="currency" id="pmax_opt" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)"">
                    </td>
                    <td><input type="text" class="currency" id="pmax_pes" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)"">
                    </td>
                    <td>Dollars</td>
                </tr>
                <tr>
                    <td><label for="r_opt"><abbr title="Total investment return rate">Rate</abbr></label></td>
                    <td><input type="text" class="currency" id="r_opt" name="fav_language" onfocus="text2per(this)" onchange="updateData()" onblur="per2text(this)"></td>
                    <td><input type="text" class="currency" id="r_pes" name="fav_language" onfocus="text2per(this)" onchange="updateData()" onblur="per2text(this)"></td>
                    <td>Percent</td>
                </tr>
                <tr>
                    <td><label for="years_opt"><abbr title="How many years till retirement">Year</abbr></label></td>
                    <td><input type="number" id="years_opt" name="fav_language" onchange="updateData()"></td>
                    <td><input type="number" id="years_pes" name="fav_language" onchange="updateData()"></td>
                    <td>Years</td>
                </tr>
                <tr>
                    <td><label for="cont_opt"><abbr title="How much you plan on saving per year">Annual
                                Contribution</abbr></label>
                    </td>
                    <td><input type="text" class="currency" id="cont_opt" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)""></td>
                    <td><input type="text" class="currency" id="cont_pes" name="fav_language" onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)""></td>
                    <td>Dollars</td>
                </tr>
                <tr>
                    <td><label for="time_opt"><abbr title="How long you'd need to contribute to hit coast">Contribution
                                Time</abbr></label></td>
                    <td><input type="number" id="time_opt" name="fav_language" style="background-color: lightgray;"
                            readonly onchange="updateData()"></td>
                    <td><input type="number" id="time_pes" name="fav_language" style="background-color: lightgray;"
                            readonly onchange="updateData()"></td>
                    <td>Years</td>
                </tr>
                <tr>
                    <td><label for="lux_opt"><abbr
                                title="How much you'd need to save continuously till retirement. If negative, how much you can afford to spend each year and still meet your goal.">Req
                                Save or
                                Spend</abbr></label></td>
                    <td><input type="number" class="currency" id="lux_opt" name="fav_language" style="background-color: lightgray;"
                            readonly></td>
                    <td><input type="number" class="currency" id="lux_pes" name="fav_language" style="background-color: lightgray;"
                            readonly onfocus="text2cur(this)" onchange="updateData()" onblur="cur2text(this)""></td>
                    <td>Dollars</td>
                </tr>
                <tr>
                    <td><label for="status_opt"><abbr title="">Status</abbr></label></td>
                    <td><input type="text" id="status_opt" name="fav_language"
                            style="background-color: lightgray;width:5em;" readonly onchange="updateData()"></td>
                    <td><input type="text" id="status_pes" name="fav_language"
                            style="background-color: lightgray;width:5em;" readonly onchange="updateData()"></td>
                    <td>Dollars</td>
                </tr>
            </table>
            <input style="width:10em;" type="button" Value="Settings" onclick="togglesave()"><input type="button"
                Value="Help" onclick="togglehelp()">
        </div>
        <div class="plot" id="plot">
            <div id="tester"></div>
        </div>
        <div class="save" id="save" style="display:none; position:fixed;">
            <div style="text-align: right;padding-right:10px;"
                onclick="document.getElementById('save').style.display = 'none';">✖️</div>
            <label for="savebox">Full JSON String</label><br>
            <div class="flex-container">
                <textarea id="savebox" rows="5"  onchange="loaddata();updateData()"></textarea><br>
            </div>
            <input type="button" value="Update parameters with string" style="width:15em;" onclick="loaddata()"><br>
            <label for="autosave">Autosave</label>
            <label class="switch">
                <input id="autosave" type="checkbox" onchange="toggleAutoSave(this)">
                <span class="slider round"></span>
            </label><br>
            <label for="logplot">Log plot</label>
            <label class="switch">
                <input id="logplot" type="checkbox" onchange="toggleLogAxis(this)">
                <span class="slider round"></span>
            </label>
            <div style="font-size:11px;color:#555;">No data is transmitted to the server, and data will be stored
                according to your browser setting. Do not enable autosave on shared devices. You can store this string
                securely on your device to reload in the future. Please note that starting year is based on system time
                so subsequent usages of this tool will generate different plots.</div>
        </div>
        <div class="help" id="help" style="display:none; position: absolute;">
            <div style="text-align: right;" onclick="togglehelp()">✖️</div>
            <h2>The Inputs</h2>
            <p>
                <strong>Principle</strong><br> How much you have. Use savings for optimistic value, and net worth for
                pessistic value.
                <hr>
            </p>
            <p>
                <strong>Goal</strong><br>
                How much you want to save
                <hr>
            </p>
            <p>
                <strong>Rate</strong><br>
                Investment return rate (7% is average inflation adjusted returns, 4% is the "safe withdrawal rate")
                <hr>
            </p>
            <p><strong>Year</strong><br>
                How far away is your goal?
                <hr>
            </p>
            <p><strong>Annual Contribution</strong><br>
                How much you contribute annually ($19.5k to max out 401k, $6k to max out IRA per person)<br>
            </p>
            <hr>
            <h2>The Outputs</h2>
            <p>
                <strong>Contribution Time</strong><br>
                How long at the current contribution rate you'd need to keep making payments
                <hr>
            </p>
            <p><strong>Required Save or Spend</strong><br>
                How much you'd need to save until your goal year to meet the goal.
                <hr>
            <div style="padding: 0 20px 0 20px;">
                If contribution rate is greater than req save, then you'll be done saving early.
                <hr>
                2000 If contribution rate is lower than req save, then you need to save more, decrease your goal, or
                extend
                your timeline.
                <hr>
                If contribution rate is negative, then you've oversaved.
            </div>
            </p>

        </div>
        <script type="text/javascript">



            TESTER = document.getElementById('tester');
            var currentTime = new Date()
            var data = [{
                x: [0, 0], y: [0, 0], name: 'Optimistic Coast'
            }, {
                x: [0, 0], y: [0, 0], name: 'Pes Coast'
            }, {
                x: [0, 0], y: [0, 0], name: 'Opt Contrib'
            }, {
                x: [0, 0], y: [0, 0], name: 'Pes Contrib'
            }]

            var layout = {
                xaxis: { 'title': 'Year', type: 'date', },
                yaxis: { 'title': '', hoverformat: '.0f', 'type': null },
                legend: { 'orientation': 'h', 'y': -0.2 },
                margin: { 't': 20, 'r': 5, 'l': 40 },
                autosize: true,
                paper_bgcolor: "#F9F9F9",
                plot_bgcolor: "FcFcFc"
            };

            Plotly.react(TESTER, data, layout);

        </script>
    </div>
    <div>
        ©️ 2021 Alex Salimian v0.18
    </div>
</body>


</html>